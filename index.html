<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Кэшбэк-таблица</title>
<style>
:root{
  --accent:#0066ff;
  --radius:8px;
  --border:#e2e8f0;
  --bg:#fafafa;
  --shadow:0 2px 6px rgba(0,0,0,.05);
  --font:"Segoe UI","Roboto","Helvetica Neue",Arial,sans-serif;
}
*{box-sizing:border-box;font-family:var(--font);}
body{margin:0;padding:1rem;max-width:1200px;margin-inline:auto;background:var(--bg);}
h1{margin:0 0 1rem 0}
.filters{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:.75rem}
.filter-group{display:flex;flex-direction:column;min-width:140px}
.filter-group label{font-size:.875rem;font-weight:600;margin-bottom:.25rem}
select,input[type="text"],button.dropdown-btn{padding:.45rem .6rem;border:1px solid var(--border);border-radius:var(--radius);background:#fff;font:inherit;}
button.dropdown-btn{cursor:pointer;display:flex;align-items:center;gap:.35rem;white-space:nowrap}
button.reset{background:#ff5252;color:#fff;border:none;border-radius:var(--radius);padding:.45rem 1rem;cursor:pointer;box-shadow:var(--shadow);}
button.reset:hover{opacity:.9}
.bank-menu{position:absolute;top:100%;left:0;width:280px;max-height:220px;overflow:auto;border:1px solid var(--border);border-radius:var(--radius);background:#fff;box-shadow:var(--shadow);padding:.35rem;display:none;z-index:10}
.bank-menu.show{display:block}
.bank-menu label{display:flex;align-items:center;gap:.5rem;padding:.25rem .4rem;border-radius:4px;cursor:pointer}
.bank-menu label:hover{background:var(--bg)}
table{width:100%;border-collapse:collapse;margin-top:.5rem}
th,td{padding:.6rem .5rem;text-align:left;border-bottom:1px solid var(--border);word-break:break-word}
thead th{background:#f0f4ff;font-weight:600}
tr:hover{background:#f5f9ff;cursor:pointer}
#hintText{margin:.75rem 0;font-size:.9rem;color:#666}
.details{margin-top:1rem;padding:1rem;border:1px solid var(--border);border-radius:var(--radius);background:#fff;box-shadow:var(--shadow);display:none;line-height:1.4}
.details h2{margin-top:0}
.hidden{display:none !important;}
@media(max-width:600px){
  /* мобильная табличная верстка */
  table,thead,tr,tbody,th,td{display:block;width:100%}
  thead{display:none}
  tr{margin-bottom:1rem;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  td{padding:.55rem 45% .55rem .6rem;border:none;border-bottom:1px solid var(--border)}
  td:last-child{border-bottom:none}
  td::before{content:attr(data-label);position:absolute;left:.75rem;font-weight:600}
}
</style>
</head>
<body>
<h1>Текущие кэшбэк-акции</h1>

<div class="filters">
  <!-- Банк (чекбоксы в dropdown) -->
  <div class="filter-group" style="position:relative">
    <label>Банк</label>
    <button id="bankBtn" class="dropdown-btn">Выбрать банк ▾</button>
    <div id="bankMenu" class="bank-menu"></div>
  </div>

  <!-- Категория -->
  <div class="filter-group">
    <label for="categoryFilter">Категория</label>
    <select id="categoryFilter"><option value="">Все</option></select>
  </div>

  <!-- Бренд -->
  <div class="filter-group">
    <label for="brandFilter">Компания/бренд</label>
    <select id="brandFilter"><option value="">Все</option></select>
  </div>

  <!-- Размер -->
  <div class="filter-group">
    <label for="sizeFilter">Размер</label>
    <select id="sizeFilter"><option value="">Все</option></select>
  </div>

  <!-- Поиск -->
  <div class="filter-group" style="flex:1;min-width:200px">
    <label for="searchInput">Поиск</label>
    <input type="text" id="searchInput" placeholder="Начните вводить…">
  </div>

  <button id="resetBtn" class="reset">Сбросить</button>
</div>

<p id="hintText">Нужно выбрать фильтр «Категория», чтобы таблица отобразилась</p>

<table id="dataTable" class="hidden">
  <thead>
    <tr><th>Банк</th><th>Компания/бренд</th><th>Размер</th></tr>
  </thead>
  <tbody></tbody>
</table>

<div id="details" class="details"></div>

<script>
// ------ ДАННЫЕ -------------------------------------------------
const data = [
  {
    "Банк":"Т-Банк",
    "Карта":"Black",
    "Категория":"Еда и продукты",
    "Компания/бренд":"Tasty Coffee",
    "Размер кэшбека/скидки ":"Кэшбэк 3%",
    "Условия (если указаны)":"На 1 покупку онлайн от 5 ₽",
    "Короткое описание компании/бренда":"Интернет-магазин свежего кофе",
    "Даты проведения акции":"С 12 по 26 мая",
    "Как получить кэшбэк":"Выберите что-нибудь на сумму от 5 ₽\nОплатите покупку любой картой Т-Банка на сайте партнера\nОплатить курьеру, в пункте выдачи заказов, по QR-коду и через СБП нельзя\nКэшбэк придет в дату следующей выписки",
    "Макс. кэшбек/скидка в руб":300,
    "Сайт":"https://shop.tastycoffee.ru/?utm_source=tinkoff",
    "О партнере":"Tasty Coffee — интернет-магазин обжарщика кофе. ..."
  },
  {
    "Банк":"Т-Банк",
    "Карта":"Black",
    "Категория":"Еда и продукты",
    "Компания/бренд":"Мануфактура Кофе",
    "Размер кэшбека/скидки ":"Кэшбэк 40%",
    "Условия (если указаны)":"На покупки онлайн",
    "Короткое описание компании/бренда":"Зерновой кофе",
    "Даты проведения акции":"С 5 мая по 4 июля",
    "Как получить кэшбэк":"Выберите что-нибудь на любую сумму\nОплатите покупку любой картой Т-Банка на сайте партнера\nКэшбэк придет в дату следующей выписки",
    "Макс. кэшбек/скидка в руб":"Максимум за одну покупку — 2000 бонусов",
    "Сайт":"https://manufactorycoffee.ru/",
    "О партнере":"Мануфактура кофе — интернет-магазин ..."
  },
  {
    "Банк":"Т-Банк",
    "Карта":"Black",
    "Категория":"Еда и продукты",
    "Компания/бренд":"Elementaree",
    "Размер кэшбека/скидки ":"Скидка 40%",
    "Условия (если указаны)":"На 1 покупку онлайн от 3 000 ₽",
    "Короткое описание компании/бренда":"Доставка наборов продуктов с рецептами для приготовления",
    "Промокод (если указан)":"tbanknew",
    "Даты проведения акции":"С 1 по 31 мая",
    "Как получить кэшбэк":"Оформите заказ на сумму от 3000 ₽ ...",
    "Дополнительная информация (если есть)":"Промокод действует ...",
    "Макс. кэшбек/скидка в руб":"Не указан",
    "Сайт":"https://elementaree.ru/",
    "О партнере":"Elementaree — доставка готовых наборов продуктов ..."
  }
];
// ---------------------------------------------------------------

// ---- КЛЮЧИ ПОЛЕЙ (trim обязательный, у одного поля есть пробел) ---
const BANK  = 'Банк',
      CAT   = 'Категория',
      BRAND = 'Компания/бренд',
      SIZE  = 'Размер кэшбека/скидки '; // <- есть пробел в конце

// ---- DOM --------------------------------------------------------
const bankBtn       = document.getElementById('bankBtn');
const bankMenu      = document.getElementById('bankMenu');
const categorySel   = document.getElementById('categoryFilter');
const brandSel      = document.getElementById('brandFilter');
const sizeSel       = document.getElementById('sizeFilter');
const searchInput   = document.getElementById('searchInput');
const resetBtn      = document.getElementById('resetBtn');
const table         = document.getElementById('dataTable');
const tbody         = table.querySelector('tbody');
const detailsBox    = document.getElementById('details');
const hintText      = document.getElementById('hintText');

// --- Состояние ---------------------------------------------------
let selectedBanks   = new Set();
let selectedCat     = '';
let selectedBrand   = '';
let selectedSize    = '';
let searchTerm      = '';

// --- Вспомогалки -------------------------------------------------
const uniq = arr => [...new Set(arr)];
const lower  = s => s.toString().toLowerCase();
const values = item => Object.values(item).join(' ♦ ');

// --- Инициализация ----------------------------------------------
initFilters();
applyFilters();

// ---- Обработчики ------------------------------------------------
bankBtn.addEventListener('click',()=>bankMenu.classList.toggle('show'));
document.addEventListener('click',e=>{
  if(!bankMenu.contains(e.target) && e.target!==bankBtn){ bankMenu.classList.remove('show');}
});
categorySel.addEventListener('change',e=>{selectedCat=e.target.value;applyFilters();});
brandSel.addEventListener('change',e=>{selectedBrand=e.target.value;applyFilters();});
sizeSel.addEventListener('change',e=>{selectedSize=e.target.value;applyFilters();});
searchInput.addEventListener('input',e=>{searchTerm=e.target.value.trim();applyFilters();});
resetBtn.addEventListener('click',()=>{
  selectedBanks.clear();
  selectedCat=selectedBrand=selectedSize=searchTerm='';
  searchInput.value='';
  [...bankMenu.querySelectorAll('input[type=checkbox]')].forEach(c=>c.checked=false);
  categorySel.value=brandSel.value=sizeSel.value='';
  applyFilters();
});

// ---- Основные функции ------------------------------------------
function initFilters(){
  // Банк (чекбоксы)
  const banks = uniq(data.map(r=>r[BANK])).sort();
  bankMenu.innerHTML = banks.map(b=>`
      <label><input type="checkbox" value="${b}"> ${b}</label>`).join('');
  bankMenu.querySelectorAll('input').forEach(cb=>{
    cb.addEventListener('change',()=>{
      cb.checked ? selectedBanks.add(cb.value) : selectedBanks.delete(cb.value);
      applyFilters();
    });
  });
  // Остальные селекты
  fillSelect(categorySel, uniq(data.map(r=>r[CAT])));
  fillSelect(brandSel   , uniq(data.map(r=>r[BRAND])));
  fillSelect(sizeSel    , uniq(data.map(r=>r[SIZE])));
}

function applyFilters(){
  // отфильтрованный массив
  const filtered = data.filter(item=>{
    if(selectedBanks.size && !selectedBanks.has(item[BANK])) return false;
    if(selectedCat && item[CAT]!==selectedCat) return false;
    if(selectedBrand && item[BRAND]!==selectedBrand) return false;
    if(selectedSize && item[SIZE]!==selectedSize) return false;
    if(searchTerm && !lower(values(item)).includes(lower(searchTerm))) return false;
    return true;
  });

  // подсказка / видимость таблицы
  const showTable = (selectedCat || searchTerm.length);
  table.classList.toggle('hidden',!showTable);
  hintText.style.display = showTable ? 'none':'block';

  // ререндер table
  renderTable(filtered);

  // пересчёт опций селектов (чтобы оставлять только допустимые комбинации)
  updateSelectOptions(filtered);

  // сброс деталей, если текущая запись ушла из списка
  if(detailsBox.style.display==='block' && !filtered.some(r=>r.id===detailsBox.dataset.id)){
    detailsBox.style.display='none';
  }
}

function renderTable(rows){
  tbody.innerHTML = rows.map((r,i)=>`
    <tr data-index="${i}">
      <td data-label="Банк">${r[BANK]}</td>
      <td data-label="Компания/бренд">${r[BRAND]}</td>
      <td data-label="Размер">${r[SIZE]}</td>
    </tr>`).join('');

  [...tbody.querySelectorAll('tr')].forEach(tr=>{
    tr.addEventListener('click',()=>{
      const item = rows[tr.dataset.index];
      showDetails(item);
    });
  });
}

function showDetails(item){
  detailsBox.style.display='block';
  detailsBox.innerHTML = `
    <h2>${item[BRAND]} — ${item[BANK]}</h2>
    <div>${Object.entries(item).map(([k,v])=>`<p><strong>${k}:</strong> ${v}</p>`).join('')}</div>`;
}

function fillSelect(sel, list){
  sel.innerHTML = '<option value="">Все</option>' +
    list.sort().map(v=>`<option>${v}</option>`).join('');
}

function updateSelectOptions(currentRows){
  // при обновлении сохраняем уже выбранное (если ещё актуально)
  const upd = (sel,key,keepVal) =>{
    const opts = uniq(currentRows.map(r=>r[key]));
    const cur  = sel.value;
    fillSelect(sel,opts);
    if(opts.includes(cur)) sel.value=cur;
    else if(!keepVal) { // сбросить если значение пропало
      if(sel===categorySel) selectedCat='';
      if(sel===brandSel)    selectedBrand='';
      if(sel===sizeSel)     selectedSize='';
    }
  };
  upd(categorySel,CAT,true);
  upd(brandSel,BRAND,true);
  upd(sizeSel ,SIZE,true);
}
</script>
</body>
</html>
